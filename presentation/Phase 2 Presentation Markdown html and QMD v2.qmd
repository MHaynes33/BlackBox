---
title: "Phase 2 – Feature Engineering and Baseline Modeling"
format: html
editor: visual
---

# Goal

Translate Phase 1 behavioral findings into engineered efficiency features and evaluate how well baseline models approximate ACME’s legacy reimbursement logic.

During Phase 2, we also completed a consolidated exploratory data analysis (EDA) that formalized and extended the statistical insights from Phase 1, providing a unified assessment of data quality, distributions, and feature behavior to support feature engineering and baseline modeling.

-------

*This phase establishes a quantitative benchmark before introducing more complex non-linear and ensemble models.*

# Exploratory Data Analysis (Extended from Phase 1) Preview/Key Findings

## Data Sources

We used two ACME datasets:

-   **public_cases** — 1,000 rows\
    Contains 4 columns: `trip_duration_days`, `miles_traveled`, `total_receipts_amount`, `expected_output`

-   **private_cases** — 5,000 rows\
    Contains 3 columns : `trip_duration_days`, `miles_traveled`, `total_receipts_amount`

After merging (6,000 rows), `expected_output` was renamed **`reimbursement`**.

## Data Quality & Completeness

| Feature | Missing Values | \% Missing | Notes |
|------------------|------------------|-----------------:|--------------------|
| trip_duration_days | 0 | 0% | Clean |
| miles_traveled | 0 | 0% | Clean |
| total_receipts_amount | 0 | 0% | Clean |
| reimbursement | 5000 | 83.3% | Missing for private_cases by design; these values must be predicted |

**Interpretation:**\
All input features are complete. The only missing values are the reimbursement values for private cases, which is the target the model must predict.

## Range Validation

All features fell within plausible travel ranges:

-   Duration: **1–14 days**\
-   Miles: **5–1,348.59 miles**\
-   Receipts: **\$0.27–\$2,503.46**\
-   Reimbursement (public): **\$117.24–\$2,337.73**

No unrealistic or negative values appeared.

## Outlier Check

A standard **1.5×IQR** test showed:

-   0 outliers in public cases\
-   0 outliers in private cases\
-   Derived efficiency features showed expected long right tails, but not statistical anomalies

This confirmed the dataset is stable and modeling-ready.

## Statistical Summary

Public and private data distributions were nearly identical:

-   Mean duration ≈ **7.17 days**\
-   Mean mileage ≈ **590 miles**\
-   Mean receipts ≈ **\$1,190**\
-   Mean reimbursement (public) ≈ **\$1,349**

**Conclusion:**\
No domain drift exists between labeled and unlabeled cases, supporting a single combined modeling strategy.

## Key EDA Insights

-   `total_receipts_amount` and `miles_traveled` are the strongest drivers of reimbursement.\
-   `trip_duration_days` has moderate influence.\
-   Distributions reveal right-skewed, diminishing-return behavior.\
-   These patterns reinforce Phase 1 findings of nonlinear legacy system logic.

## EDA Workup Sources

The full exploratory data analysis (EDA), covering missingness assessment, range validation, statistical profiling, and all visualizations, are documented in the project’s Jupyter notebooks.”

-   [Data Quality & Cleaning Jupyter Notebook](https://github.com/MHaynes33/BlackBox/blob/main/Notebooks/week1_data_cleaning.ipynb)

-   [Statistical Summary & Plots (Combined Data) Jupyter Notebook](https://github.com/MHaynes33/BlackBox/blob/main/Notebooks/01_EDA_Reimbursement%20(3).ipynb)

## To access the full EDA:

-   [EDA](https://github.com/MHaynes33/BlackBox/blob/main/reports/EDA%20%26%20Baseline%20Model%20Info.html)

*The last section of the EDA also covers the baseline model and the performance summary that we will be going over on Phase 2*

------------------------------------------------------------------------

# What happened during Phase 2 after an EDA was compiled encompassing the data analysis from Phase 1?

## Feature Engineering

Phase 1 showed that ACME’s reimbursement behavior depends not just on raw totals, but on trip efficiency, balance, and nonlinear thresholds. Thus, we engineered four derived features to capture this behavior.

### Engineered Features

| Feature | Formula | Purpose |
|------------------|-------------------------|-----------------------------|
| cost_per_day | receipts ÷ days | Daily spending intensity |
| cost_per_mile | receipts ÷ miles | Travel efficiency per mile |
| miles_per_day | miles ÷ days | Travel intensity |
| cost_ratio | cost_per_day ÷ cost_per_mile | Balance of time vs distance-based costs |

### Rationale

These engineered features:

-   Encode diminishing returns.\
-   Capture tiering behavior observed in interviews.\
-   Reflect ACME’s emphasis on “balanced travel.”\
-   Provide interaction signals non-linearly.

To ensure quality:

-   All divisions were guarded against zero.\
-   `inf`/`NaN` values were replaced.\
-   IQR checks confirmed no row removals were required.

### Feature Distribution Findings:

![](images/clipboard-1593421446.png)

-   Right-skewed long tails.\
-   Concentration at low-cost ranges.\
-   Positive, business-consistent values.\
-   No missing or invalid values.

This aligns with Phase 1 qualitative insights that most trips are modest, with few extreme business journeys.

*- To familiarize yourself with all the features used in the model (engineered and given), including their analytical purpose and relationship to predicting `reimbursement` visit this document* [Features and Their Purpose](https://github.com/MHaynes33/BlackBox/blob/main/reports/Feature%20Definitions%20and%20Rationales%20Table%20Updated%20.qmd)

*- The details examining and generating the engineered features are accessible at this Jupyter Notebook* [Engineered Features and Baseline Models](https://github.com/MHaynes33/BlackBox/blob/main/Notebooks/02_Feature_Engineering_and_Baseline_Model.ipynb)

------------------------------------------------------------------------

## Correlation & Feature Importance

### Correlation Matrix (Engineered Features → Reimbursement)

![](images/matrix.png){width="434"}

**What does this tell us?**

[Strongest correlations:]{.underline}

-   `total_receipts_amount` (\~0.70)\
-   `miles_traveled` (\~0.43)\
-   `trip_duration_days` (\~0.51)

Engineered features were weak individually, but they gain importance when interacting within nonlinear models.

### Top 5 Drivers of Reimbursement

![](images/top%205%20reimbursement.png)

1.  total_receipts_amount\
2.  trip_duration_days\
3.  miles_traveled\
4.  cost_per_day\
5.  cost_per_mile

These findings confirm:

-   ACME’s legacy logic is **cost-dominant**.\
-   Mileage provides **secondary effects**.\
-   Duration matters but has **diminishing returns**.\
-   Derived features add nuance but often interact nonlinearly.

*To access the detailed workup visualizing various features and their relationship to reimbursement, check this Jupyter Notebook:* [Engineered Features & Reimbursement](https://github.com/MHaynes33/BlackBox/blob/main/Notebooks/Feature%20Correlation%20and%20Visualization.ipynb)

------------------------------------------------------------------------

# Baseline Modeling

## Modeling Setup

-   **Features:** 7 engineered + original numeric predictors\
-   **Target:** `reimbursement`\
-   **Split:** 75% train / 25% test\
-   **Models Tested:**
    -   Linear Regression\
    -   Ridge Regression (α = 1.0)\
    -   Lasso Regression (α = 0.01)\
    -   Polynomial Regression (Degree 2)

Data used for Phase 2 Baseline Model: [Phase 2 Baseline Model Data](https://github.com/MHaynes33/BlackBox/blob/main/data/phase2_features_baseline_models.csv)

## Performance Summary

| Model | R² | RMSE | MAE | Interpretation |
|---------------|---------------|---------------|---------------|---------------|
| Linear | 0.784 | 199.85 | 159.59 | Captures most linear behaviors |
| Ridge | 0.784 | 199.84 | — | Stabilizes coefficients |
| Lasso | 0.784 | 199.85 | — | Produces simpler model |
| Polynomial (deg = 2) | 0.892 | 141.64 | — | Best fit; captures nonlinear legacy rules |

*The performance metrics are detailed on this Jupyter Notebook*[Performance Metrics](https://github.com/MHaynes33/BlackBox/blob/main/Notebooks/Performance%20Summary.ipynb)

## Interpretation

-   The linear model explains **\~78%** of the variance.\
-   The polynomial model explains **\~89%** — a substantial improvement.\
-   Nonlinear interactions are necessary to mimic ACME’s legacy engine.\
-   Error magnitudes (MAE, RMSE) are low relative to average reimbursement (\~\$1,300).

## Error Behavior

-   Residuals cluster around zero.\
-   Deviations come from rare long-tail business trips.\
-   This matches Phase 1 insight: the legacy logic includes **tiering**, **thresholds**, and **diminishing returns**.

------------------------------------------------------------------------

# Best Baseline Model: Polynomial Regression

![](images/clipboard-1309328638.png)

The polynomial model produced predictions tightly clustered along the ideal diagonal line, indicating:

-   Strong approximation of legacy behavior.\
-   Accurate modeling of nonlinear interactions.\
-   Small deviation for high-receipt trips (expected due to legacy adjustment quirks).

*The details examining and generating the baseline models and engineered features are accessible at this Jupyter Notebook* [Engineered Features and Baseline Models](https://github.com/MHaynes33/BlackBox/blob/main/Notebooks/02_Feature_Engineering_and_Baseline_Model.ipynb)

------------------------------------------------------------------------

# Phase 2 Key Insights

-   Receipts remain the strongest reimbursement predictor.\
-   Mileage and duration provide important secondary effects.\
-   Engineered features matter when used in combination.\
-   Linear models capture broad structure.\
-   Polynomial models approximate legacy rules far more closely.\
-   No data quality issues hinder modeling.

------------------------------------------------------------------------

# Business Interpretation (Takeaway)

Linear models explain much of the reimbursement behavior, but do not capture the subtleties of ACME’s tiered and diminishing-return logic.

Engineered features introduced in Phase 2 capture:

-   Efficiency patterns,\
-   Spending intensity,\
-   Balance between mileage and daily expenses, and\
-   Nonlinear interactions.

Polynomial modeling revealed that ACME’s legacy engine likely uses curved formulas, threshold-based adjustments, and nonlinear multipliers, confirming insights from Phase 1 interviews.

------------------------------------------------------------------------

# Phase 2 Conclusion

Phase 2 successfully:

-   Integrated all Phase 1 statistical and interview findings.\
-   Developed new engineered features that reflect real-world reimbursement behavior.\
-   Built multiple baseline models to measure how well simple and nonlinear structures approximate the legacy engine.\
-   Demonstrated that polynomial regression provides the strongest match to legacy reimbursement behavior.\
-   Established a solid benchmark before advancing to complex ensemble models in Phase 3.

The dataset, engineered features, and baseline modeling pipeline are now fully prepared for **Phase 3: Modeling Outlook & Integration Plan**.
